<!DOCTYPE html>
<html>
<head>
    <title>Test AgriGuru Authentication</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 500px; margin: 0 auto; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin: 20px 0; padding: 10px; border: 1px solid #ddd; background: #f9f9f9; }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
    </style>
</head>
<body>
    <div class="container">
        <h1>AgriGuru Authentication Test</h1>
        
        <!-- Database Status -->
        <div>
            <h3>Database Status</h3>
            <button onclick="testDatabase()">Check Database</button>
            <div id="dbResult" class="result"></div>
        </div>
        
        <!-- Signup Form -->
        <div>
            <h3>Sign Up</h3>
            <div class="form-group">
                <label>Full Name:</label>
                <input type="text" id="signupName" placeholder="John Doe" value="Test User">
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="signupEmail" placeholder="john@example.com" value="test@agriguru.com">
            </div>
            <div class="form-group">
                <label>Phone:</label>
                <input type="tel" id="signupPhone" placeholder="+1234567890" value="1234567890">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="signupPassword" placeholder="Password123" value="TestPass123">
            </div>
            <button onclick="signup()">Sign Up</button>
            <div id="signupResult" class="result"></div>
        </div>
        
        <!-- Login Form -->
        <div>
            <h3>Login</h3>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="loginEmail" placeholder="john@example.com" value="test@agriguru.com">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="loginPassword" placeholder="Password123" value="TestPass123">
            </div>
            <button onclick="login()">Login</button>
            <div id="loginResult" class="result"></div>
        </div>
        
        <!-- Current Users -->
        <div>
            <h3>Current Users</h3>
            <button onclick="viewUsers()">View All Users</button>
            <div id="usersResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5001/api';
        
        async function testDatabase() {
            try {
                const response = await fetch(`${API_BASE}/test-db`);
                const result = await response.json();
                
                const resultDiv = document.getElementById('dbResult');
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ Database Connected!</strong><br>
                        Database: ${result.database_name}<br>
                        Collection: ${result.collection_name}<br>
                        Total Users: ${result.total_users}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<strong>‚ùå Database Error:</strong> ${result.error}`;
                }
            } catch (error) {
                document.getElementById('dbResult').innerHTML = `<strong>‚ùå Connection Error:</strong> ${error.message}`;
                document.getElementById('dbResult').className = 'result error';
            }
        }
        
        async function signup() {
            const data = {
                full_name: document.getElementById('signupName').value,
                email: document.getElementById('signupEmail').value,
                phone: document.getElementById('signupPhone').value,
                password: document.getElementById('signupPassword').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/signup`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                const resultDiv = document.getElementById('signupResult');
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<strong>‚úÖ ${result.message}</strong><br>User ID: ${result.user_id}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<strong>‚ùå ${result.message}</strong>`;
                }
            } catch (error) {
                document.getElementById('signupResult').innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
                document.getElementById('signupResult').className = 'result error';
            }
        }
        
        async function login() {
            const data = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include', // Important for sessions
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                const resultDiv = document.getElementById('loginResult');
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>‚úÖ ${result.message}</strong><br>
                        Welcome: ${result.user.full_name}<br>
                        Email: ${result.user.email}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<strong>‚ùå ${result.message}</strong>`;
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
                document.getElementById('loginResult').className = 'result error';
            }
        }
        
        async function viewUsers() {
            try {
                const response = await fetch(`${API_BASE}/test-db`);
                const result = await response.json();
                
                const resultDiv = document.getElementById('usersResult');
                if (result.success && result.sample_users.length > 0) {
                    resultDiv.className = 'result success';
                    let html = `<strong>üìã Users in Database (${result.total_users} total):</strong><br><br>`;
                    result.sample_users.forEach(user => {
                        html += `
                            üìß ${user.email}<br>
                            üë§ ${user.full_name}<br>
                            üìû ${user.phone || 'No phone'}<br>
                            üìÖ ${new Date(user.created_at).toLocaleString()}<br><br>
                        `;
                    });
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = '<strong>üìù No users found in database</strong>';
                }
            } catch (error) {
                document.getElementById('usersResult').innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
                document.getElementById('usersResult').className = 'result error';
            }
        }
        
        // Test database on page load
        window.onload = function() {
            testDatabase();
        };
    </script>
</body>
</html>
